<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Banco Imperial - O Futuro do Banking Digital">
    <meta name="theme-color" content="#2E046D">
    <title>Banco Imperial | Internet Banking Enterprise</title>

    <style>
        /* --- RESET & VARIAVEIS GLOBAIS --- */
        :root {
            /* Palette Imperial */
            --color-primary: #2E046D; /* Roxo Imperial Profundo */
            --color-primary-light: #5e35b1;
            --color-primary-dark: #20024D;
            --color-accent: #FFD700; /* Ouro Nobre */
            --color-success: #00C853;
            --color-danger: #D50000;
            --color-warning: #FFAB00;
            --color-info: #00B0FF;
            
            /* Neutros */
            --color-bg: #F4F6F8;
            --color-surface: #FFFFFF;
            --color-text-primary: #1A1A1A;
            --color-text-secondary: #666666;
            --color-border: #E0E0E0;

            /* Sombras & Efeitos */
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            
            /* Transi√ß√µes */
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Acessibilidade - Alto Contraste */
        body.high-contrast {
            --color-primary: #000000;
            --color-primary-light: #333333;
            --color-bg: #FFFFFF;
            --color-text-primary: #000000;
            --color-text-secondary: #000000;
            --color-accent: #FFFF00;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        body {
            background-color: var(--color-bg);
            color: var(--color-text-primary);
            font-size: 16px;
            line-height: 1.5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* --- UTILITIES --- */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .w-full { width: 100%; }
        .text-center { text-align: center; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-4 { margin-top: 2rem; }
        .mb-2 { margin-bottom: 1rem; }
        .p-4 { padding: 2rem; }
        .font-bold { font-weight: 700; }
        .text-primary { color: var(--color-primary); }
        .text-danger { color: var(--color-danger); }
        .text-success { color: var(--color-success); }
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }

        /* --- COMPONENTES UI --- */
        
        /* Bot√µes */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-fast);
            font-size: 1rem;
            text-decoration: none;
            gap: 0.5rem;
        }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn:focus-visible { outline: 3px solid var(--color-accent); outline-offset: 2px; }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
            box-shadow: var(--shadow-md);
        }
        .btn-primary:hover:not(:disabled) { background-color: var(--color-primary-dark); transform: translateY(-1px); }

        .btn-secondary {
            background-color: transparent;
            border: 2px solid var(--color-primary);
            color: var(--color-primary);
        }
        .btn-secondary:hover { background-color: rgba(46, 4, 109, 0.05); }

        .btn-danger {
            background-color: var(--color-danger);
            color: white;
        }

        /* Inputs */
        .form-group { margin-bottom: 1.25rem; text-align: left; }
        .form-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--color-text-secondary); }
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--color-border);
            border-radius: var(--radius-md);
            font-size: 1rem;
            transition: var(--transition-fast);
            background: white;
        }
        .form-input:focus {
            border-color: var(--color-primary);
            outline: none;
            box-shadow: 0 0 0 4px rgba(46, 4, 109, 0.1);
        }
        .form-error { color: var(--color-danger); font-size: 0.875rem; margin-top: 0.25rem; display: none; }

        /* Cards */
        .card {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(0,0,0,0.05);
            margin-bottom: 1.5rem;
        }

        /* --- LAYOUT ESPEC√çFICO --- */

        /* Header */
        .app-header {
            background: var(--color-primary);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-md);
        }
        .logo-container { display: flex; align-items: center; gap: 0.75rem; font-weight: 800; font-size: 1.25rem; letter-spacing: -0.5px; }
        .logo-icon { width: 32px; height: 32px; fill: var(--color-accent); }

        /* Views */
        .view-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
            flex: 1;
            width: 100%;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Auth Screen */
        .auth-wrapper {
            max-width: 480px;
            margin: 4rem auto;
            text-align: center;
        }
        .auth-header { margin-bottom: 2rem; }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        .balance-card {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            color: white;
            position: relative;
            overflow: hidden;
        }
        .balance-card::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 200px;
            height: 200px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            pointer-events: none;
        }
        .balance-amount { font-size: 2.5rem; font-weight: 700; margin: 0.5rem 0; letter-spacing: -1px; }

        /* Action Buttons Grid */
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        @media (max-width: 600px) { .actions-grid { grid-template-columns: repeat(2, 1fr); } }

        .action-btn {
            background: white;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: var(--transition-fast);
            color: var(--color-text-primary);
        }
        .action-btn:hover { border-color: var(--color-primary); background: #f8f5ff; }
        .action-icon { font-size: 1.5rem; }

        /* Listas */
        .transaction-list { list-style: none; }
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--color-border);
        }
        .transaction-item:last-child { border-bottom: none; }
        .t-icon { width: 40px; height: 40px; border-radius: 50%; background: #eee; display: flex; align-items: center; justify-content: center; margin-right: 1rem; }
        .t-pos { color: var(--color-success); }
        .t-neg { color: var(--color-text-primary); }

        /* Loading Overlay */
        #loading-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        .spinner {
            width: 50px; height: 50px;
            border: 4px solid rgba(46, 4, 109, 0.1);
            border-left-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Notification / Toast */
        #notification-area {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toast {
            background: #333;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            animation: slideIn 0.3s ease;
            max-width: 350px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .toast.success { border-left: 4px solid var(--color-success); background: #1a1a1a; }
        .toast.error { border-left: 4px solid var(--color-danger); background: #1a1a1a; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* Admin & Table */
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th, .data-table td { padding: 1rem; text-align: left; border-bottom: 1px solid var(--color-border); }
        .data-table th { background: #f9fafb; font-weight: 600; }
        .tag { padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; }
        .tag-admin { background: #E3F2FD; color: #1565C0; }
        .tag-owner { background: #F3E5F5; color: #7B1FA2; }

        /* Cart√£o de Cr√©dito */
        .credit-card-visual {
            background: linear-gradient(135deg, #111, #333);
            color: #fff;
            padding: 1.5rem;
            border-radius: 12px;
            position: relative;
            height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            margin-bottom: 1rem;
        }
        .chip { width: 40px; height: 30px; background: #FFD700; border-radius: 4px; margin-bottom: 1rem; opacity: 0.8; }
        .card-number { font-family: 'Courier New', monospace; font-size: 1.5rem; letter-spacing: 2px; }
        .card-name { text-transform: uppercase; font-size: 0.9rem; }
        
        /* Chatbot */
        .chat-window { height: 400px; display: flex; flex-direction: column; border: 1px solid var(--color-border); border-radius: var(--radius-md); overflow: hidden; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 1rem; background: #f9f9f9; }
        .chat-input-area { padding: 1rem; background: white; border-top: 1px solid var(--color-border); display: flex; gap: 0.5rem; }
        .msg { padding: 0.5rem 1rem; border-radius: 1rem; margin-bottom: 0.5rem; max-width: 80%; }
        .msg-bot { background: #E0E0E0; align-self: flex-start; border-bottom-left-radius: 0; }
        .msg-user { background: var(--color-primary); color: white; align-self: flex-end; margin-left: auto; border-bottom-right-radius: 0; }

    </style>
</head>
<body>

    <div id="loading-overlay" class="hidden">
        <div class="spinner"></div>
        <p class="mt-2 font-bold text-primary">Processando Transa√ß√£o Segura...</p>
    </div>

    <div id="notification-area"></div>

    <header class="app-header hidden" id="main-header">
        <div class="view-container flex justify-between items-center" style="padding: 0; margin: 0 auto;">
            <div class="logo-container">
                <svg class="logo-icon" viewBox="0 0 24 24">
                    <path d="M5 16L3 5L8.5 10L12 4L15.5 10L21 5L19 16H5M19 19C19 19.6 18.6 20 18 20H6C5.4 20 5 19.6 5 19V18H19V19Z" />
                </svg>
                BANCO IMPERIAL
            </div>
            <nav class="flex items-center gap-2">
                <button class="btn btn-secondary text-white" style="border-color:white; color: white;" onclick="app.toggleHighContrast()" aria-label="Alto Contraste">
                    üëÅÔ∏è
                </button>
                <div id="user-pill" class="text-sm font-bold bg-white text-primary px-3 py-1 rounded-full">
                    </div>
                <button class="btn btn-danger text-sm" onclick="auth.logout()" aria-label="Sair">Sair</button>
            </nav>
        </div>
    </header>

    <main id="app">

        <section id="view-login" class="view-container auth-wrapper">
            <div class="card">
                <div class="auth-header">
                    <svg class="logo-icon" style="width: 64px; height: 64px; fill: var(--color-primary);" viewBox="0 0 24 24">
                        <path d="M5 16L3 5L8.5 10L12 4L15.5 10L21 5L19 16H5M19 19C19 19.6 18.6 20 18 20H6C5.4 20 5 19.6 5 19V18H19V19Z" />
                    </svg>
                    <h1 class="text-primary mt-2">Banco Imperial</h1>
                    <p class="text-secondary">Exclusividade e Seguran√ßa Enterprise</p>
                </div>

                <form id="login-form" onsubmit="auth.handleLogin(event)">
                    <div class="form-group">
                        <label for="login-cpf" class="form-label">CPF</label>
                        <input type="text" id="login-cpf" class="form-input" placeholder="000.000.000-00" maxlength="14" required aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="login-pass" class="form-label">Senha de Acesso</label>
                        <input type="password" id="login-pass" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required aria-required="true">
                    </div>
                    <button type="submit" class="btn btn-primary w-full">Acessar Conta</button>
                </form>

                <div class="mt-4">
                    <p class="text-sm">N√£o √© cliente Imperial?</p>
                    <button class="btn btn-secondary w-full mt-1" onclick="router.navigate('register')">Solicitar Abertura de Conta</button>
                </div>
                <div class="mt-2 text-xs text-secondary">
                    <p>Ambiente Seguro ‚Ä¢ Criptografia de Ponta a Ponta</p>
                </div>
            </div>
        </section>

        <section id="view-register" class="view-container auth-wrapper hidden">
            <div class="card">
                <h2 class="text-primary mb-2">Novo Associado</h2>
                <form id="register-form" onsubmit="auth.handleRegister(event)">
                    <div class="form-group">
                        <label for="reg-name" class="form-label">Nome Completo</label>
                        <input type="text" id="reg-name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-cpf" class="form-label">CPF</label>
                        <input type="text" id="reg-cpf" class="form-input" placeholder="000.000.000-00" maxlength="14" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-pass" class="form-label">Senha (Min 6 caracteres)</label>
                        <input type="password" id="reg-pass" class="form-input" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="reg-pass-confirm" class="form-label">Confirmar Senha</label>
                        <input type="password" id="reg-pass-confirm" class="form-input" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-full">Finalizar Cadastro</button>
                    <button type="button" class="btn btn-secondary w-full mt-2" onclick="router.navigate('login')">Voltar</button>
                </form>
            </div>
        </section>

        <section id="view-dashboard" class="view-container hidden">
            <div class="card balance-card">
                <div class="flex justify-between items-center">
                    <span>Saldo Dispon√≠vel</span>
                    <button class="btn btn-sm" style="background:rgba(255,255,255,0.2); color:white;" onclick="dashboard.toggleBalance()">üëÅÔ∏è</button>
                </div>
                <div class="balance-amount" id="dash-balance">R$ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
                <div class="text-sm opacity-80" id="dash-account-info">Ag: 0001 | CC: 00000-0</div>
            </div>

            <h3 class="font-bold text-primary mb-2">Servi√ßos</h3>
            <div class="actions-grid">
                <button class="action-btn" onclick="router.navigate('pix')">
                    <span class="action-icon">üí†</span>
                    PIX
                </button>
                <button class="action-btn" onclick="router.navigate('cards')">
                    <span class="action-icon">üí≥</span>
                    Cart√µes
                </button>
                <button class="action-btn" onclick="router.navigate('invest')">
                    <span class="action-icon">üìà</span>
                    Investir
                </button>
                <button class="action-btn" onclick="router.navigate('help')">
                    <span class="action-icon">ü§ñ</span>
                    Ajuda IA
                </button>
                <button class="action-btn hidden" id="btn-admin-panel" onclick="router.navigate('admin')">
                    <span class="action-icon">üîê</span>
                    Admin
                </button>
            </div>

            <div class="card mt-4">
                <h3 class="font-bold text-primary mb-2">Extrato Recente</h3>
                <ul class="transaction-list" id="dash-history">
                    <li class="text-center py-4 text-secondary">Carregando movimenta√ß√µes...</li>
                </ul>
            </div>
        </section>

        <section id="view-pix" class="view-container hidden">
            <button class="btn btn-secondary mb-2" onclick="router.navigate('dashboard')">‚Üê Voltar</button>
            <div class="card">
                <h2 class="text-primary font-bold mb-2">√Årea PIX</h2>
                <div class="form-group">
                    <label class="form-label">Saldo Dispon√≠vel: <span id="pix-balance" class="font-bold">...</span></label>
                </div>

                <form onsubmit="transaction.handlePix(event)">
                    <div class="form-group">
                        <label for="pix-cpf" class="form-label">CPF do Recebedor</label>
                        <input type="text" id="pix-cpf" class="form-input" placeholder="000.000.000-00" maxlength="14" required>
                    </div>
                    <div class="form-group">
                        <label for="pix-amount" class="form-label">Valor (R$)</label>
                        <input type="number" id="pix-amount" class="form-input" step="0.01" min="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="pix-desc" class="form-label">Descri√ß√£o (Opcional)</label>
                        <input type="text" id="pix-desc" class="form-input" maxlength="50">
                    </div>
                    <button type="submit" class="btn btn-primary w-full">Confirmar Transfer√™ncia</button>
                </form>
            </div>
        </section>

        <section id="view-admin" class="view-container hidden">
            <button class="btn btn-secondary mb-2" onclick="router.navigate('dashboard')">‚Üê Voltar</button>
            <div class="card border-primary">
                <div class="flex justify-between">
                    <h2 class="text-primary font-bold">PAINEL ENTERPRISE</h2>
                    <span class="tag tag-admin" id="admin-badge">ADMIN</span>
                </div>
                
                <div class="mt-4 p-4 bg-gray-100 rounded">
                    <h3 class="font-bold mb-2">Emiss√£o de Boletos (Owners Only)</h3>
                    <div id="admin-boleto-area">
                        <form onsubmit="admin.createBoleto(event)">
                            <div class="form-group">
                                <label class="form-label">Tipo de Emiss√£o</label>
                                <select id="boleto-type" class="form-input">
                                    <option value="individual">Individual (CPF Espec√≠fico)</option>
                                    <option value="global">GLOBAL (Todos os usu√°rios)</option>
                                </select>
                            </div>
                            <div class="form-group" id="boleto-cpf-group">
                                <label class="form-label">CPF Alvo</label>
                                <input type="text" id="boleto-cpf" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Valor (R$)</label>
                                <input type="number" id="boleto-amount" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Descri√ß√£o</label>
                                <input type="text" id="boleto-desc" class="form-input" value="Taxa de Manuten√ß√£o" required>
                            </div>
                            <button type="submit" class="btn btn-danger w-full">‚ö° EMITIR COBRAN√áA</button>
                        </form>
                    </div>
                </div>

                <div class="mt-4">
                    <h3 class="font-bold mb-2">Auditoria do Sistema</h3>
                    <div style="max-height: 300px; overflow-y: auto; border:1px solid #ddd;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Evento</th>
                                    <th>Detalhes</th>
                                </tr>
                            </thead>
                            <tbody id="admin-logs-body">
                                </tbody>
                        </table>
                    </div>
                    <button class="btn btn-secondary mt-2 w-full" onclick="admin.refreshLogs()">Atualizar Logs</button>
                </div>
            </div>
        </section>

        <section id="view-cards" class="view-container hidden">
            <button class="btn btn-secondary mb-2" onclick="router.navigate('dashboard')">‚Üê Voltar</button>
            <h2 class="text-primary font-bold mb-4">Meus Cart√µes</h2>
            
            <div class="credit-card-visual">
                <div class="flex justify-between">
                    <span class="font-bold">IMPERIAL BLACK</span>
                    <span>üëë</span>
                </div>
                <div class="chip"></div>
                <div class="card-number" id="card-display-num">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
                <div class="flex justify-between items-end">
                    <div class="card-name" id="card-display-name">NOME DO USU√ÅRIO</div>
                    <div class="text-sm">VAL 12/29</div>
                </div>
            </div>

            <div class="card">
                <div class="flex justify-between items-center mb-2">
                    <span class="font-bold">Cart√£o Virtual</span>
                    <button class="btn btn-sm btn-primary" onclick="cards.generateVirtual()">Gerar Novo CVV</button>
                </div>
                <hr class="mb-2">
                <p>Status: <span class="text-success font-bold">ATIVO</span></p>
                <p>Limite Dispon√≠vel: <span class="font-bold">R$ 12.500,00</span></p>
                <div class="mt-4">
                    <h4 class="font-bold mb-1">√öltimas Compras</h4>
                    <p class="text-secondary text-sm">Nenhuma compra recente no cart√£o.</p>
                </div>
            </div>
        </section>

        <section id="view-invest" class="view-container hidden">
            <button class="btn btn-secondary mb-2" onclick="router.navigate('dashboard')">‚Üê Voltar</button>
            <div class="card border-primary" style="border-width: 2px;">
                <h2 class="text-primary font-bold mb-2">Investimento de Alto Risco</h2>
                <div class="p-4 bg-yellow-50 text-yellow-800 rounded mb-4 text-sm border border-yellow-200">
                    <strong>‚ö†Ô∏è AVISO LEGAL:</strong> Este produto financeiro possui volatilidade extrema.
                    Historicamente, 85% das opera√ß√µes resultam em perda total do capital investido.
                </div>

                <div class="text-center mb-4">
                    <div class="text-4xl mb-2">üé∞</div>
                    <p>Multiplicador Potencial: <strong>5.0x</strong></p>
                    <p>Probabilidade de Ganho: <strong>15%</strong></p>
                </div>

                <form onsubmit="invest.play(event)">
                    <div class="form-group">
                        <label class="form-label">Valor do Aporte (R$)</label>
                        <input type="number" id="invest-amount" class="form-input" min="10" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-full" style="background: #FF6D00;">Realizar Aporte</button>
                </form>
                <div id="invest-result" class="mt-4 text-center font-bold"></div>
            </div>
        </section>

        <section id="view-help" class="view-container hidden">
            <button class="btn btn-secondary mb-2" onclick="router.navigate('dashboard')">‚Üê Voltar</button>
            <div class="card p-0 overflow-hidden">
                <div class="p-4 bg-primary text-white flex items-center gap-2">
                    <span>ü§ñ</span>
                    <strong>Imperial AI</strong>
                </div>
                <div class="chat-window">
                    <div class="chat-messages" id="chat-feed">
                        <div class="msg msg-bot">Ol√°! Sou a IA do Banco Imperial. Como posso ajudar voc√™ hoje?</div>
                    </div>
                    <form class="chat-input-area" onsubmit="chatbot.send(event)">
                        <input type="text" id="chat-input" class="form-input" placeholder="Digite sua d√∫vida..." autocomplete="off">
                        <button type="submit" class="btn btn-primary">Enviar</button>
                    </form>
                </div>
            </div>
        </section>

    </main>

    <script>
        /**
         * BANCO IMPERIAL - CORE SYSTEM
         * Author: Senior Architect
         * Version: 1.0.0 Enterprise
         */

        // --- CONFIGURATIONS ---
        const CONFIG = {
            FIREBASE_URL: "https://banco-imperial-default-rtdb.firebaseio.com",
            API_KEY: "AIzaSyDWat0SS6tRICcLAOmNy843MUoicfTfD8I", // Note: API Key is mostly for SDK, REST uses URL
            ROLES: {
                USER: 'USER',
                ADMIN: 'ADMIN', // Dono do Banco
                MASTER: 'MASTER' // Dono do RP
            },
            PASSWORDS: {
                MASTER: '172244',
                ADMIN: 'ryan_imperial'
            }
        };

        // --- STATE MANAGEMENT ---
        const state = {
            currentUser: null,
            token: null,
            usersCache: {}, // Cache simples para evitar leituras excessivas
            transactions: []
        };

        // --- UTILS MODULE ---
        const utils = {
            // Formata moeda
            formatCurrency: (value) => {
                return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
            },
            
            // Mascara CPF simples (apenas visual)
            maskCPF: (cpf) => {
                return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
            },

            // Limpa CPF para numeros
            cleanCPF: (cpf) => {
                return cpf.replace(/\D/g, '');
            },

            // Gera data atual formatada
            getDateTime: () => {
                return new Date().toLocaleString('pt-BR');
            },

            // Toast Notifications
            notify: (message, type = 'info') => {
                const area = document.getElementById('notification-area');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span>
                    <span>${message}</span>
                `;
                area.appendChild(toast);
                setTimeout(() => toast.remove(), 4000);
            },

            // Loading Spinner
            toggleLoading: (show) => {
                const el = document.getElementById('loading-overlay');
                if(show) el.classList.remove('hidden');
                else el.classList.add('hidden');
            },

            // Gera ID √∫nico
            generateId: () => {
                return 'tx_' + Math.random().toString(36).substr(2, 9);
            }
        };

        // --- API LAYER (FIREBASE REST) ---
        // Implementa√ß√£o manual de fetch para evitar bibliotecas externas
        const api = {
            async get(path) {
                try {
                    const response = await fetch(`${CONFIG.FIREBASE_URL}/${path}.json`);
                    if (!response.ok) throw new Error('Falha na conex√£o');
                    return await response.json();
                } catch (error) {
                    console.error("API GET Error:", error);
                    utils.notify("Erro de conex√£o com o banco.", "error");
                    return null;
                }
            },

            async put(path, data) {
                try {
                    const response = await fetch(`${CONFIG.FIREBASE_URL}/${path}.json`, {
                        method: 'PUT',
                        body: JSON.stringify(data),
                        headers: { 'Content-Type': 'application/json' }
                    });
                    return await response.json();
                } catch (error) {
                    utils.notify("Erro ao salvar dados.", "error");
                    throw error;
                }
            },

            async patch(path, data) {
                 try {
                    const response = await fetch(`${CONFIG.FIREBASE_URL}/${path}.json`, {
                        method: 'PATCH', // Update partial
                        body: JSON.stringify(data),
                        headers: { 'Content-Type': 'application/json' }
                    });
                    return await response.json();
                } catch (error) {
                    throw error;
                }
            },

            async post(path, data) {
                try {
                    const response = await fetch(`${CONFIG.FIREBASE_URL}/${path}.json`, {
                        method: 'POST', // Push list
                        body: JSON.stringify(data),
                        headers: { 'Content-Type': 'application/json' }
                    });
                    return await response.json();
                } catch (error) {
                    throw error;
                }
            }
        };

        // --- AUTH CONTROLLER ---
        const auth = {
            async handleLogin(e) {
                e.preventDefault();
                utils.toggleLoading(true);

                const cpf = utils.cleanCPF(document.getElementById('login-cpf').value);
                const pass = document.getElementById('login-pass').value;

                if (cpf.length !== 11) {
                    utils.toggleLoading(false);
                    return utils.notify("CPF inv√°lido.", "error");
                }

                try {
                    // Busca usu√°rio
                    const user = await api.get(`users/${cpf}`);

                    if (!user) {
                        utils.toggleLoading(false);
                        return utils.notify("Usu√°rio n√£o encontrado.", "error");
                    }

                    // Verifica senha (Simples compara√ß√£o direta para este prot√≥tipo, em prod usar√≠amos hash)
                    // Verifica tamb√©m senhas mestras
                    let role = CONFIG.ROLES.USER;
                    let validPass = (user.password === pass);

                    // Override para donos
                    if (pass === CONFIG.PASSWORDS.MASTER) {
                        validPass = true;
                        role = CONFIG.ROLES.MASTER;
                        utils.notify("üëë Acesso MASTER concedido", "success");
                    } else if (pass === CONFIG.PASSWORDS.ADMIN) {
                        validPass = true;
                        role = CONFIG.ROLES.ADMIN;
                        utils.notify("üü£ Acesso ADMIN concedido", "success");
                    }

                    if (validPass) {
                        state.currentUser = { ...user, cpf, role: role }; // Atualiza role na sess√£o
                        
                        // Atualiza role no banco se for login especial para garantir persist√™ncia futura
                        if(role !== user.role && (role === CONFIG.ROLES.MASTER || role === CONFIG.ROLES.ADMIN)) {
                             await api.patch(`users/${cpf}`, { role: role });
                        }

                        this.initSession();
                    } else {
                        // Log tentativa falha
                        await api.post('logs', {
                            type: 'LOGIN_FAIL',
                            cpf: cpf,
                            date: utils.getDateTime()
                        });
                        utils.notify("Senha incorreta.", "error");
                    }

                } catch (err) {
                    console.error(err);
                    utils.notify("Erro no sistema de login.", "error");
                } finally {
                    utils.toggleLoading(false);
                }
            },

            async handleRegister(e) {
                e.preventDefault();
                utils.toggleLoading(true);

                const name = document.getElementById('reg-name').value;
                const cpf = utils.cleanCPF(document.getElementById('reg-cpf').value);
                const pass = document.getElementById('reg-pass').value;
                const passConfirm = document.getElementById('reg-pass-confirm').value;

                if (pass !== passConfirm) {
                    utils.toggleLoading(false);
                    return utils.notify("Senhas n√£o conferem.", "error");
                }

                if (cpf.length !== 11) {
                    utils.toggleLoading(false);
                    return utils.notify("CPF inv√°lido.", "error");
                }

                try {
                    // Check exist√™ncia
                    const exists = await api.get(`users/${cpf}`);
                    if (exists) {
                        utils.toggleLoading(false);
                        return utils.notify("CPF j√° cadastrado.", "error");
                    }

                    const newUser = {
                        name: name,
                        password: pass, // Nota: Em prod real, hash aqui.
                        balance: 1000.00, // B√¥nus inicial
                        role: CONFIG.ROLES.USER,
                        createdAt: utils.getDateTime(),
                        account: '0001-' + Math.floor(Math.random() * 10000)
                    };

                    await api.put(`users/${cpf}`, newUser);
                    
                    // Log
                    await api.post('logs', { type: 'REGISTER', cpf: cpf, date: utils.getDateTime() });

                    utils.notify("Conta criada com sucesso! Fa√ßa login.", "success");
                    router.navigate('login');

                } catch (err) {
                    utils.notify("Erro ao criar conta.", "error");
                } finally {
                    utils.toggleLoading(false);
                }
            },

            initSession() {
                document.getElementById('user-pill').innerText = state.currentUser.name.split(' ')[0];
                document.getElementById('main-header').classList.remove('hidden');
                
                // Show Admin Button if permission
                const adminBtn = document.getElementById('btn-admin-panel');
                const adminBadge = document.getElementById('admin-badge');
                
                if (state.currentUser.role === CONFIG.ROLES.ADMIN || state.currentUser.role === CONFIG.ROLES.MASTER) {
                    adminBtn.classList.remove('hidden');
                    if(adminBadge) adminBadge.innerText = state.currentUser.role;
                } else {
                    adminBtn.classList.add('hidden');
                }

                router.navigate('dashboard');
                dashboard.refresh();
            },

            logout() {
                state.currentUser = null;
                document.getElementById('main-header').classList.add('hidden');
                document.getElementById('login-form').reset();
                router.navigate('login');
                utils.notify("Sess√£o finalizada.", "info");
            }
        };

        // --- ROUTER & VIEW CONTROLLER ---
        const router = {
            navigate(viewId) {
                // Hide all views
                document.querySelectorAll('.view-container').forEach(el => el.classList.add('hidden'));
                
                // Show target
                const target = document.getElementById(`view-${viewId}`);
                if (target) {
                    target.classList.remove('hidden');
                    window.scrollTo(0, 0);
                }
                
                // Specific init logic
                if (viewId === 'dashboard') dashboard.refresh();
                if (viewId === 'admin') admin.init();
                if (viewId === 'cards') cards.init();
            }
        };

        // --- DASHBOARD CONTROLLER ---
        const dashboard = {
            async refresh() {
                if (!state.currentUser) return;
                
                // Reload user data to ensure balance is up to date
                const freshUser = await api.get(`users/${state.currentUser.cpf}`);
                state.currentUser = { ...state.currentUser, ...freshUser };

                document.getElementById('dash-balance').setAttribute('data-value', state.currentUser.balance);
                document.getElementById('dash-account-info').innerText = `Ag: 0001 | CC: ${state.currentUser.account}`;
                this.renderBalance();
                this.loadHistory();
            },

            toggleBalance() {
                const el = document.getElementById('dash-balance');
                if (el.innerText.includes('‚Ä¢')) {
                    el.innerText = utils.formatCurrency(el.getAttribute('data-value'));
                } else {
                    el.innerText = 'R$ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                }
            },

            renderBalance() {
                // Default to masked
                document.getElementById('dash-balance').innerText = 'R$ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
            },

            async loadHistory() {
                const list = document.getElementById('dash-history');
                list.innerHTML = '<li class="text-center py-4 text-secondary">Carregando...</li>';
                
                // Mock fetch transactions (Na pr√°tica buscar√≠amos em /transactions filtrando por CPF, 
                // mas Firebase Realtime n√£o tem "query" complexa sem √≠ndices. 
                // Para este demo, buscaremos os logs recentes onde o user est√° envolvido)
                
                // Solu√ß√£o otimizada para "Single File": 
                // Vamos ler os logs gerais e filtrar no cliente (n√£o ideal para produ√ß√£o real massiva, ok para demo)
                const allLogs = await api.get('logs'); // Retorna objeto
                if(!allLogs) {
                     list.innerHTML = '<li class="text-center py-4 text-secondary">Sem movimenta√ß√µes.</li>';
                     return;
                }

                const myLogs = Object.values(allLogs)
                    .filter(log => log.cpf === state.currentUser.cpf || log.targetCpf === state.currentUser.cpf)
                    .sort((a, b) => b.date.localeCompare(a.date)) // Sort decrescente simples
                    .slice(0, 5); // Apenas 5

                list.innerHTML = '';
                if(myLogs.length === 0) {
                     list.innerHTML = '<li class="text-center py-4 text-secondary">Sem movimenta√ß√µes recentes.</li>';
                     return;
                }

                myLogs.forEach(log => {
                    let icon = 'üìÑ';
                    let valClass = '';
                    let signal = '';
                    let desc = log.type;

                    if (log.type === 'PIX_SENT') { icon = 'üí∏'; valClass = 't-neg'; signal = '-'; desc = `Envio PIX para ${log.targetName || '...'}`; }
                    if (log.type === 'PIX_RECEIVED') { icon = 'üí∞'; valClass = 't-pos'; signal = '+'; desc = `Recebido PIX de ${log.originName || '...'}`; }
                    if (log.type === 'BOLETO_PAID') { icon = 'üßæ'; valClass = 't-neg'; signal = '-'; desc = 'Pagamento de Boleto'; }
                    if (log.type === 'INVEST_WIN') { icon = 'üìà'; valClass = 't-pos'; signal = '+'; desc = 'Rendimento Investimento'; }
                    if (log.type === 'INVEST_LOSS') { icon = 'üìâ'; valClass = 't-neg'; signal = '-'; desc = 'Perda Investimento'; }

                    // Se n√£o tem valor, pula (ex: login)
                    if (!log.amount) return;

                    const li = document.createElement('li');
                    li.className = 'transaction-item';
                    li.innerHTML = `
                        <div class="flex items-center">
                            <div class="t-icon">${icon}</div>
                            <div>
                                <div class="font-bold">${desc}</div>
                                <div class="text-xs text-secondary">${log.date}</div>
                            </div>
                        </div>
                        <div class="font-bold ${valClass}">
                            ${signal} ${utils.formatCurrency(log.amount)}
                        </div>
                    `;
                    list.appendChild(li);
                });
            }
        };

        // --- TRANSACTION CONTROLLER (PIX) ---
        const transaction = {
            async handlePix(e) {
                e.preventDefault();
                utils.toggleLoading(true);

                const targetCpf = utils.cleanCPF(document.getElementById('pix-cpf').value);
                const amount = parseFloat(document.getElementById('pix-amount').value);
                const desc = document.getElementById('pix-desc').value;

                // Valida√ß√µes
                if (targetCpf === state.currentUser.cpf) {
                    utils.toggleLoading(false);
                    return utils.notify("N√£o pode transferir para si mesmo.", "error");
                }
                if (amount > state.currentUser.balance) {
                    utils.toggleLoading(false);
                    return utils.notify("Saldo insuficiente.", "error");
                }
                
                // Anti-fraude b√°sico
                if (amount > 5000) {
                     // Flag transaction logic placeholder
                     await api.post('logs', {
                        type: 'FRAUD_ALERT',
                        cpf: state.currentUser.cpf,
                        amount: amount,
                        details: 'Tentativa de PIX alto valor',
                        date: utils.getDateTime()
                    });
                    // Continua, mas loga. Em real, bloquearia.
                }

                try {
                    // Busca destinat√°rio
                    const targetUser = await api.get(`users/${targetCpf}`);
                    if (!targetUser) {
                        utils.toggleLoading(false);
                        return utils.notify("Destinat√°rio n√£o encontrado.", "error");
                    }

                    // L√≥gica de Transfer√™ncia "At√¥mica" (Mockada sequencial)
                    // 1. Debita
                    const newBalanceUser = state.currentUser.balance - amount;
                    await api.patch(`users/${state.currentUser.cpf}`, { balance: newBalanceUser });
                    
                    // 2. Credita
                    const newBalanceTarget = (targetUser.balance || 0) + amount;
                    await api.patch(`users/${targetCpf}`, { balance: newBalanceTarget });

                    // 3. Logs
                    const date = utils.getDateTime();
                    // Log para quem enviou
                    await api.post('logs', {
                        type: 'PIX_SENT',
                        cpf: state.currentUser.cpf,
                        targetCpf: targetCpf,
                        targetName: targetUser.name,
                        amount: amount,
                        desc: desc,
                        date: date
                    });
                    // Log para quem recebeu
                    await api.post('logs', {
                        type: 'PIX_RECEIVED',
                        cpf: targetCpf, // O log pertence ao cpf chave
                        originCpf: state.currentUser.cpf,
                        originName: state.currentUser.name,
                        amount: amount,
                        date: date
                    });

                    utils.notify("Transfer√™ncia realizada com sucesso!", "success");
                    router.navigate('dashboard');

                } catch (err) {
                    console.error(err);
                    utils.notify("Erro ao processar transa√ß√£o.", "error");
                } finally {
                    utils.toggleLoading(false);
                }
            }
        };

        // --- ADMIN CONTROLLER ---
        const admin = {
            init() {
                // Previne acesso n√£o autorizado via console/url manipula√ß√£o
                if (state.currentUser.role === CONFIG.ROLES.USER) {
                    utils.notify("Acesso negado.", "error");
                    router.navigate('dashboard');
                    return;
                }
                
                // Setup de visualiza√ß√£o de tipos de boleto
                document.getElementById('boleto-type').addEventListener('change', (e) => {
                    const cpfGroup = document.getElementById('boleto-cpf-group');
                    if (e.target.value === 'global') {
                        cpfGroup.classList.add('hidden');
                    } else {
                        cpfGroup.classList.remove('hidden');
                    }
                });

                this.refreshLogs();
            },

            async createBoleto(e) {
                e.preventDefault();
                utils.toggleLoading(true);

                const type = document.getElementById('boleto-type').value;
                const amount = parseFloat(document.getElementById('boleto-amount').value);
                const desc = document.getElementById('boleto-desc').value;

                try {
                    if (type === 'individual') {
                        const targetCpf = utils.cleanCPF(document.getElementById('boleto-cpf').value);
                        
                        // Validar usuario
                        const target = await api.get(`users/${targetCpf}`);
                        if(!target) throw new Error("CPF n√£o encontrado");

                        // Debitar direto (Modo RP: Boleto j√° desconta ou cria d√≠vida? 
                        // O prompt diz "Criar boletos... Enviar boletos". 
                        // Vamos debitar direto para simplificar o fluxo de "Cobran√ßa For√ßada" t√≠pica de RP)
                        const newBal = target.balance - amount;
                        await api.patch(`users/${targetCpf}`, { balance: newBal });
                        
                        // Log
                        await api.post('logs', {
                            type: 'BOLETO_FORCED',
                            cpf: targetCpf,
                            amount: amount,
                            reason: desc,
                            admin: state.currentUser.name,
                            date: utils.getDateTime()
                        });

                        utils.notify(`Cobran√ßa aplicada a ${target.name}`, "success");

                    } else if (type === 'global') {
                        // MASTER ONLY
                        if (state.currentUser.role !== CONFIG.ROLES.MASTER) {
                            throw new Error("Apenas MASTER pode emitir boletos globais.");
                        }

                        // Busca todos (perigoso se base enorme, ok para demo)
                        const allUsers = await api.get('users');
                        if (!allUsers) throw new Error("Sem usu√°rios.");

                        let count = 0;
                        for (const [keyCpf, userData] of Object.entries(allUsers)) {
                            // Ignora admins na cobran√ßa global (opcional)
                            if (userData.role === CONFIG.ROLES.USER) {
                                const newBal = (userData.balance || 0) - amount;
                                // Fire and forget para agilidade, sem await no loop idealmente, 
                                // mas JS single thread precisa de cuidado. Faremos sequencial.
                                await api.patch(`users/${keyCpf}`, { balance: newBal });
                                count++;
                            }
                        }

                        await api.post('logs', {
                            type: 'GLOBAL_TAX',
                            amount: amount,
                            affected: count,
                            admin: state.currentUser.name,
                            date: utils.getDateTime()
                        });

                        utils.notify(`Taxa global aplicada a ${count} cidad√£os.`, "success");
                    }
                } catch (err) {
                    utils.notify(err.message || "Erro na opera√ß√£o.", "error");
                } finally {
                    utils.toggleLoading(false);
                    document.getElementById('view-admin').querySelector('form').reset();
                }
            },

            async refreshLogs() {
                const tbody = document.getElementById('admin-logs-body');
                tbody.innerHTML = '<tr><td colspan="3">Carregando auditoria...</td></tr>';

                const logs = await api.get('logs');
                tbody.innerHTML = '';

                if (!logs) {
                    tbody.innerHTML = '<tr><td colspan="3">Sem registros.</td></tr>';
                    return;
                }

                // Converter para array e ordenar
                const logArray = Object.values(logs).sort((a,b) => b.date.localeCompare(a.date)).slice(0, 20);

                logArray.forEach(log => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="text-xs">${log.date}</td>
                        <td class="text-sm font-bold">${log.type}</td>
                        <td class="text-xs">
                            ${log.cpf ? 'User:' + log.cpf : ''} <br>
                            ${log.amount ? 'R$ ' + log.amount : ''} <br>
                            ${log.details || log.desc || ''}
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            }
        };

        // --- INVESTIMENTOS ---
        const invest = {
            async play(e) {
                e.preventDefault();
                const amount = parseFloat(document.getElementById('invest-amount').value);
                const resDiv = document.getElementById('invest-result');
                
                if(amount > state.currentUser.balance) return utils.notify("Saldo insuficiente", "error");

                utils.toggleLoading(true);

                // Simulando delay de mercado
                setTimeout(async () => {
                    const win = Math.random() < 0.15; // 15% chance
                    let newBalance = 0;
                    
                    if (win) {
                        const profit = amount * 5;
                        newBalance = state.currentUser.balance + profit; // Devolve aposta + lucro? N√£o, ganha 5x o valor. O valor original j√° estava no saldo.
                        // Corre√ß√£o l√≥gica: Se eu tenho 100, aposto 10.
                        // Win: Ganho 50. Saldo = 100 - 10 (aposta) + 50 (premio) = 140.
                        // Vamos simplificar: Deduz aposta primeiro.
                        
                        // Atualiza logica
                        const currentBal = state.currentUser.balance - amount;
                        const finalBal = currentBal + (amount * 5);
                        
                        await api.patch(`users/${state.currentUser.cpf}`, { balance: finalBal });
                        
                        resDiv.innerHTML = `<span class="text-success text-xl">LUCRO! Voc√™ ganhou R$ ${utils.formatCurrency(amount * 5)}</span>`;
                        utils.notify("Retorno de Investimento Recebido!", "success");

                        await api.post('logs', {
                            type: 'INVEST_WIN',
                            cpf: state.currentUser.cpf,
                            amount: amount * 5,
                            date: utils.getDateTime()
                        });
                    } else {
                        const finalBal = state.currentUser.balance - amount;
                        await api.patch(`users/${state.currentUser.cpf}`, { balance: finalBal });
                        
                        resDiv.innerHTML = `<span class="text-danger">Perda Total. O mercado oscilou.</span>`;
                        utils.notify("Investimento Liquidado.", "warning");

                        await api.post('logs', {
                            type: 'INVEST_LOSS',
                            cpf: state.currentUser.cpf,
                            amount: amount,
                            date: utils.getDateTime()
                        });
                    }

                    // Refresh balance visual only
                    const updatedUser = await api.get(`users/${state.currentUser.cpf}`);
                    state.currentUser.balance = updatedUser.balance;
                    
                    utils.toggleLoading(false);
                }, 1500);
            }
        };

        // --- CARDS MODULE ---
        const cards = {
            init() {
                if(state.currentUser) {
                    document.getElementById('card-display-name').innerText = state.currentUser.name;
                }
            },
            generateVirtual() {
                utils.toggleLoading(true);
                setTimeout(() => {
                    utils.toggleLoading(false);
                    utils.notify("Novo CVV Gerado: " + Math.floor(Math.random() * 899 + 100), "success");
                }, 1000);
            }
        };

        // --- CHATBOT ---
        const chatbot = {
            send(e) {
                e.preventDefault();
                const input = document.getElementById('chat-input');
                const text = input.value.trim().toLowerCase();
                const feed = document.getElementById('chat-feed');

                if (!text) return;

                // User msg
                const uDiv = document.createElement('div');
                uDiv.className = 'msg msg-user';
                uDiv.innerText = input.value;
                feed.appendChild(uDiv);

                input.value = '';

                // Bot Logic
                setTimeout(() => {
                    let reply = "Desculpe, n√£o entendi. Tente 'pix', 'saldo' ou 'cart√£o'.";
                    
                    if (text.includes('pix')) reply = "O PIX funciona 24h. V√° na aba 'Servi√ßos' > 'PIX' e digite o CPF do destinat√°rio.";
                    if (text.includes('saldo') || text.includes('dinheiro')) reply = `Seu saldo atual √© de R$ ${utils.formatCurrency(state.currentUser.balance)}.`;
                    if (text.includes('cart√£o') || text.includes('limite')) reply = "Seu cart√£o Imperial Black possui limite din√¢mico baseado em sua reputa√ß√£o no RP.";
                    if (text.includes('invest') || text.includes('ganhar')) reply = "Temos o Investimento de Alto Risco. Cuidado! H√° 85% de chance de perda.";
                    if (text.includes('admin') || text.includes('dono')) reply = "Fun√ß√µes administrativas s√£o restritas ao Sr. Ryan e Master.";

                    const bDiv = document.createElement('div');
                    bDiv.className = 'msg msg-bot';
                    bDiv.innerText = reply;
                    feed.appendChild(bDiv);
                    feed.scrollTop = feed.scrollHeight;
                }, 600);
            }
        };

        // --- GLOBAL & UI HELPERS ---
        const app = {
            toggleHighContrast() {
                document.body.classList.toggle('high-contrast');
            }
        };

        // Init Check
        // Se houver sess√£o (sessionStorage) poderia restaurar aqui, mas para seguran√ßa Enterprise,
        // for√ßamos login novo no refresh da p√°gina.

    </script>
</body>
</html>
